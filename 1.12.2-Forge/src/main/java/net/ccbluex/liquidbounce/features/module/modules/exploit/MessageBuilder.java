package net.ccbluex.liquidbounce.features.module.modules.exploit;

import net.ccbluex.liquidbounce.api.minecraft.network.play.client.ICPacketChatMessage;
import net.ccbluex.liquidbounce.event.EventTarget;
import net.ccbluex.liquidbounce.event.PacketEvent;
import net.ccbluex.liquidbounce.features.module.Module;
import net.ccbluex.liquidbounce.features.module.ModuleCategory;
import net.ccbluex.liquidbounce.features.module.ModuleInfo;

/**
 * @author LangYa466
 * @date 2024/4/30 19:28
 */

@ModuleInfo(name = "MessageBuilder", description = "Allows you to send custom messages.", category = ModuleCategory.EXPLOIT)
public class MessageBuilder extends Module {

    @EventTarget
    public void onPacket(PacketEvent event) {
        if (classProvider.isCPacketChatMessage(event.getPacket())) {
            ICPacketChatMessage chatMessage = event.getPacket().asCPacketChatMessage();
            String message = chatMessage.getMessage();
            StringBuilder stringBuilder = new StringBuilder();
            boolean check = false;

            for (char c : message.toCharArray()) {
                if (c >= 33 && c <= 128) {
                    if (c == '/') {
                        check = true;
                    }
                    if (!check) {
                        stringBuilder.append((char) (c + 65248));
                    }
                    if (check) {
                        stringBuilder.append(c);
                    }
                } else {
                    stringBuilder.append(c);
                }
            }

            chatMessage.setMessage(stringBuilder.toString());

        }
    }

}
